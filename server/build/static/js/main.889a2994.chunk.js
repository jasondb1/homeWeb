(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,n){e.exports=n(39)},33:function(e,t,n){},34:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(23),c=n.n(o),s=(n(32),n(33),n(2)),l=n(3),i=n(5),u=n(4),m=n(6),h=n(12),d=n(14),f=(n(34),n(7)),p=Object(f.a)(),v=n(41);function b(e){return e.text().then(function(t){var n=t&&JSON.parse(t);if(!e.ok){-1!==[401,403].indexOf(e.status)&&(O.logout(),window.location.reload(!0));var a=n&&n.message||e.statusText;return Promise.reject(a)}return n})}var g={apiUrl:"http://localhost:3001/api"},E=new v.a(JSON.parse(localStorage.getItem("currentUser"))),O={login:function(e,t){console.log("login");var n={method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})};return fetch("".concat(g.apiUrl,"/users/authenticate"),n).then(b).then(function(e){return localStorage.setItem("currentUser",JSON.stringify(e)),E.next(e),e})},logout:function(){localStorage.removeItem("currentUser"),E.next(null)},currentUser:E.asObservable(),get currentUserValue(){return E.value}};var N=n(24),y=function(e){var t=e.component,n=Object(N.a)(e,["component"]);return r.a.createElement(h.b,Object.assign({},n,{render:function(e){return O.currentUserValue?r.a.createElement(t,e):r.a.createElement(h.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},j=n(13),k=n(9),w=function(e){function t(e){var n;return Object(s.a)(this,t),n=Object(i.a)(this,Object(u.a)(t).call(this,e)),O.currentUserValue&&n.props.history.push("/"),n.state={username:"",password:"",submitted:!1},n.handleChange=n.handleChange.bind(Object(k.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(k.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){var t=e.target,n=t.name,a=t.value;this.setState(Object(j.a)({},n,a))}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({submitted:!0});var t=this.state,n=t.username,a=t.password;n&&a&&O.login(n,a)}},{key:"render",value:function(){var e=this.state,t=e.username,n=e.password,a=e.submitted;return r.a.createElement("div",{className:"col-md-6 col-md-offset-3"},r.a.createElement("h2",null,"Login"),r.a.createElement("form",{name:"form",onSubmit:this.handleSubmit},r.a.createElement("div",{className:"form-group"+(a&&!t?" has-error":"")},r.a.createElement("label",{htmlFor:"username"},"Username"),r.a.createElement("input",{type:"text",className:"form-control",name:"username",value:t,onChange:this.handleChange}),a&&!t&&r.a.createElement("div",{className:"help-block"},"Username is required")),r.a.createElement("div",{className:"form-group"+(a&&!n?" has-error":"")},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",className:"form-control",name:"password",value:n,onChange:this.handleChange}),a&&!n&&r.a.createElement("div",{className:"help-block"},"Password is required")),r.a.createElement("div",{className:"form-group"},r.a.createElement("button",{className:"btn btn-primary"},"Login"))))}}]),t}(r.a.Component),C=n(16);function S(){var e=O.currentUserValue;return e&&e.token?{Authorization:"Bearer ".concat(e.token)}:{}}var U={register:function(e){var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return fetch("".concat(T.apiUrl,"/users/register"),t).then(b)},getAll:function(){var e={method:"GET",headers:S()};return fetch("".concat(T.apiUrl,"/users"),e).then(b)},getById:function(e){var t={method:"GET",headers:S()};return fetch("".concat(T.apiUrl,"/users/").concat(e),t).then(b)},update:function(e){var t={method:"PUT",headers:Object(C.a)({},S(),{"Content-Type":"application/json"}),body:JSON.stringify(e)};return fetch("".concat(T.apiUrl,"/users/").concat(e.id),t).then(b)},delete:function(e){var t={method:"DELETE",headers:S()};return fetch("".concat(T.apiUrl,"/users/").concat(e),t).then(b)}},T={apiUrl:"http://localhost:3001/api"};var P=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={currentUser:O.currentUserValue,users:null,user:{firstName:"",lastName:"",username:"",password:"",email:""},submitted:!1},n.handleChange=n.handleChange.bind(Object(k.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(k.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;U.getAll().then(function(t){return e.setState({users:t})})}},{key:"handleChange",value:function(e){var t=e.target,n=t.name,a=t.value,r=this.state.user;this.setState({user:Object(C.a)({},r,Object(j.a)({},n,a))})}},{key:"handleSubmit",value:function(e){console.log("handle submit"),e.preventDefault(),this.setState({submitted:!0});var t=this.state.user;t.firstName&&t.lastName&&t.username&&t.password&&U.register(t)}},{key:"render",value:function(){var e=this.state,t=e.user,n=e.submitted;return r.a.createElement("div",{className:"col-md-6 col-md-offset-3"},r.a.createElement("h2",null,"Register"),r.a.createElement("form",{name:"form",onSubmit:this.handleSubmit},r.a.createElement("div",{className:"form-group"+(n&&!t.firstName?" has-error":"")},r.a.createElement("label",{htmlFor:"firstName"},"First Name"),r.a.createElement("input",{type:"text",className:"form-control",name:"firstName",value:t.firstName,onChange:this.handleChange}),n&&!t.firstName&&r.a.createElement("div",{className:"help-block"},"First Name is required")),r.a.createElement("div",{className:"form-group"+(n&&!t.lastName?" has-error":"")},r.a.createElement("label",{htmlFor:"lastName"},"Last Name"),r.a.createElement("input",{type:"text",className:"form-control",name:"lastName",value:t.lastName,onChange:this.handleChange}),n&&!t.lastName&&r.a.createElement("div",{className:"help-block"},"Last Name is required")),r.a.createElement("div",{className:"form-group"+(n&&!t.username?" has-error":"")},r.a.createElement("label",{htmlFor:"username"},"Username"),r.a.createElement("input",{type:"text",className:"form-control",name:"username",value:t.username,onChange:this.handleChange}),n&&!t.username&&r.a.createElement("div",{className:"help-block"},"Username is required")),r.a.createElement("div",{className:"form-group"+(n&&!t.password?" has-error":"")},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",className:"form-control",name:"password",value:t.password,onChange:this.handleChange}),n&&!t.password&&r.a.createElement("div",{className:"help-block"},"Password is required")),r.a.createElement("div",{className:"form-group"+(n&&!t.email?" has-error":"")},r.a.createElement("label",{htmlFor:"lastName"},"Email"),r.a.createElement("input",{type:"email",className:"form-control",name:"email",value:t.email,onChange:this.handleChange}),n&&!t.lastName&&r.a.createElement("div",{className:"help-block"},"email is required")),r.a.createElement("div",{className:"form-group"},r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Register"),r.a.createElement(d.a,{to:"/login",className:"btn btn-link"},"Cancel"))))}}]),t}(r.a.Component),_={getStatus:function(){return new Promise(function(e,t){fetch("".concat("/api","/status")).then(function(e){return e.json()}).then(function(t){return e(t)}).catch(function(e){t(e)})})},getComponentState:function(e){return new Promise(function(t,n){fetch("".concat("/api","/component/").concat(e)).then(function(e){return e.json()}).then(function(e){return t(e)}).catch(function(e){n(e)})})},componentOn:function(e){return new Promise(function(t,n){fetch("".concat("/api","/component_on/").concat(e),{method:"POST",body:JSON.stringify({}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return t(e)}).catch(function(e){n(e)})})},componentOff:function(e){return new Promise(function(t,n){fetch("".concat("/api","/component_off/").concat(e),{method:"POST",body:JSON.stringify({}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return t(e)}).catch(function(e){n(e)})})},ledOn:function(){return new Promise(function(e,t){fetch("".concat("/api","/led_on")).then(function(e){return e.json()}).then(function(t){return e(t)}).catch(function(e){t(e)})})},ledOff:function(){return new Promise(function(e,t){fetch("".concat("/api","/led_off")).then(function(e){return e.json()}).then(function(t){return e(t)}).catch(function(e){t(e)})})}},x=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={label:e.label,isOn:e.isOn,component:e.component},n.handleClick=n.handleClick.bind(Object(k.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;_.getComponentState(this.state.component).then(function(t){return e.setState({isOn:t.isOn})})}},{key:"handleClick",value:function(){var e=this;this.state.isOn?_.componentOff(this.state.component).then(function(t){return e.setState({isOn:!1})}):_.componentOn(this.state.component).then(function(t){return e.setState({isOn:!0})})}},{key:"btnClasses",value:function(){var e="btn";return e+=!0===this.state.isOn?" btn-success":" btn-danger"}},{key:"render",value:function(){return r.a.createElement("div",{className:"control"},r.a.createElement("label",null,this.state.label),r.a.createElement("button",{onClick:this.handleClick,className:this.btnClasses()},this.state.isOn?"ON":"OFF"))}}]),t}(a.Component),L=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(i.a)(this,Object(u.a)(t).call(this))).state={},e}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Controls"),r.a.createElement("br",null),r.a.createElement(x,{label:"LED",component:"led"}),r.a.createElement(x,{label:"Relay 1",component:"relay1"}),r.a.createElement(x,{label:"Relay 2",component:"relay2"}))}}]),t}(a.Component),F=function(e){return console.log(e.values),r.a.createElement("ul",null,r.a.createElement("li",{key:"temp_local"},"Temperature Local: ",e.values.temp_local),r.a.createElement("li",{key:"humidity_local"},"Humidity Local: ",e.values.humidity_local),r.a.createElement("li",{key:"temp_remote0"},"Temperature Remote: ",e.values.temp_remote0),r.a.createElement("li",{key:"humidity_remote0"},"Humidity Remote: ",e.values.humidity_remote0),r.a.createElement("li",{key:"presistor_remote0"},"Light Remote: ",e.values.presistor_remote0))},J=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(i.a)(this,Object(u.a)(t).call(this))).state={status:[]},e.updateStatus=e.updateStatus.bind(Object(k.a)(e)),e}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.interval=setInterval(this.updateStatus,1e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"updateStatus",value:function(){var e=this;_.getStatus().then(function(t){return e.setState({status:t})})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Status"),r.a.createElement(F,{values:this.state.status}))}}]),t}(a.Component),D=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={currentUser:O.currentUserValue,users:null},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;U.getAll().then(function(t){return e.setState({users:t})})}},{key:"render",value:function(){var e=this.state,t=e.currentUser,n=e.users;return r.a.createElement("div",null,r.a.createElement("h1",null,"Hi ",t.firstName,"!"),r.a.createElement("p",null,"You're logged in with React & JWT!!"),r.a.createElement("h3",null,"Users from secure api end point:"),n&&r.a.createElement("ul",null,n.map(function(e){return r.a.createElement("li",{key:e.id},e.firstName," ",e.lastName)})),r.a.createElement(L,null),r.a.createElement(J,null))}}]),t}(r.a.Component),R=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(i.a)(this,Object(u.a)(t).call(this,e))).state={currentUser:null},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;O.currentUser.subscribe(function(t){return e.setState({currentUser:t})})}},{key:"logout",value:function(){O.logout(),p.push("/login")}},{key:"render",value:function(){var e=this.state.currentUser;return r.a.createElement("div",null,r.a.createElement("h1",null,"HomeWeb"),r.a.createElement("div",{className:"header-bar"}),r.a.createElement(h.c,{history:p},r.a.createElement("div",null,e&&r.a.createElement("nav",{className:"navbar navbar-expand navbar-dark bg-dark"},r.a.createElement("div",{className:"navbar-nav"},r.a.createElement(d.a,{to:"/",className:"nav-item nav-link"},"Home"),r.a.createElement(d.a,{to:"/register",className:"nav-item nav-link"},"Admin"),r.a.createElement("a",{href:"#fake",onClick:this.logout,className:"nav-item nav-link"},"Logout"))),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6 offset-md-3"},r.a.createElement(y,{exact:!0,path:"/",component:D}),r.a.createElement(h.b,{path:"/register",component:P}),r.a.createElement(h.b,{path:"/login",component:w})))))))}}]),t}(a.Component),A=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function q(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}c.a.render(r.a.createElement(R,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");A?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):q(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):q(e)})}}()}},[[27,1,2]]]);
//# sourceMappingURL=main.889a2994.chunk.js.map